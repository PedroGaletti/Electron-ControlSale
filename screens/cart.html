<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>288 Worship</title>
    <meta charset="utf-8"/>
    <link href="../css/photon.css" rel="stylesheet"> 
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  </head>
  <body>
    <div class="window" id="table-estoque">
      <div class="center-horizontal hundred-margin">
        <image src="../images/Logo-AmareloEpreto.png" class="image center" />
        <table class="table-striped">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Valor</th>
              <th>Cod. Produto</th>
              <th>Remover</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="product in products">
              <td>{{ product.name }}</td>
              <td>{{ product.value }}</td>
              <td>{{ product.id }}</td>
              <td>
                <button
                  type="button"
                  class="btn btn-form btn-primary"
                  @click="removeProductCart(product)"
                >
                  Remover
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <footer class="toolbar toolbar-footer">
        <div class="toolbar-actions">
          <button
            class="btn btn-default"
            type="button"
            @click="finishCart(true)"
          >
            Cancelar Compra (Esc)
          </button>
      
          <button
            type="button"
            @click="finishCart(false)"
            class="btn btn-primary pull-right"
          >
            Finalizar Compra (Enter)
          </button>
        </div>
      </footer>
    </div>
  </body>
  <script>
    const read = require('read-file-utf8')
    const loki = require('lokijs');
    const db = new loki('db.json');
    const data = read('db.json');
    db.loadJSON(data);
    const cart = db.getCollection('cart');
    const sales = db.getCollection('sales');

    window.vue = require('vue');
    new Vue({
      el: '#table-estoque',
      data: {
        products: [],
      },
      mounted: function() {
        this.products = cart.data;
      },
      methods: {
        removeProductCart: function(product) {
          cart.remove(product);
          db.save();
        },
        finishCart: function(param) {
          // if (!param && cart.data.length) {
          //   sales.insert({
          //     products: cart.data,
          //     date: new Date(),
          //   });
          // }

          db.removeCollection('cart');
          db.save();
          this.products = [];
        },
      },
    });
  </script>
</html>